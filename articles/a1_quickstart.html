<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Quick Start Guide • command</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quick Start Guide">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">command</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a1_quickstart.html">Quick Start Guide</a></li>
    <li><a class="dropdown-item" href="../articles/a2_shell_script.html">Creating a Shell Script</a></li>
    <li><a class="dropdown-item" href="../articles/a3_makefile.html">Creating a Makefile</a></li>
    <li><a class="dropdown-item" href="../articles/a4_workflow.html">Modular Workflows</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quick Start Guide</h1>
            
      

      <div class="d-none name"><code>a1_quickstart.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This article shows how to get started with package
<strong>command</strong>.</p>
<p>The main function in <strong>command</strong> is
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code>, which assigns objects to the global
environment. <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> can be called in two ways:</p>
<ol style="list-style-type: decimal">
<li>Interatively</li>
<li>Inside a script that is run from the command line</li>
</ol>
<p>Case 2 is the important one. Case 1 is simpler, however, so we look
at that first.</p>
</div>
<div class="section level2">
<h2 id="calling-cmd_assign-interactively">Calling <code>cmd_assign()</code> interactively<a class="anchor" aria-label="anchor" href="#calling-cmd_assign-interactively"></a>
</h2>
<p>Running</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">cmd_assign</span>(<span class="at">obj1 =</span> <span class="st">"a"</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>           <span class="at">obj2 =</span> <span class="dv">1</span><span class="st">"))</span></span></code></pre></div>
<p>has the same effect as running</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj1</span> <span class="op">&lt;-</span> <span class="st">"orange"</span></span>
<span><span class="va">obj2</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
<p>Both snippets add two objects to the global environment with names
<code>"obj1"</code> and <code>"obj2"</code> and values
<code>"orange"</code> and <code>1</code>.</p>
<p>Objects assigned by <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> can have the following
classes:</p>
<ul>
<li>character, eg <code>"Hello world"</code>
</li>
<li>integer, eg <code>3L</code>
</li>
<li>numeric, eg <code>3.141593</code>
</li>
<li>date, eg <code>as.Date("2015-11-03")</code>
</li>
<li>date-time using POSIXct, eg
<code>as.POSIXct("2015-11-03 14:23:03")</code>
</li>
<li>date-time using POSIXlt, eg
<code>as.POSIXlt("2015-11-03 14:23:03")</code>
</li>
<li><code>NULL</code></li>
</ul>
<p>The objects must have length 1, except for <code>NULL</code>, which
has length 0.</p>
<p>The typical reason for using <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> interactively
is to develop code that will eventually sit in a script that is run from
the command line.</p>
<p>The most common way to run R scripts from the command line is with
Rscript, so we take a detour to look at that.</p>
</div>
<div class="section level2">
<h2 id="rscript">Rscript<a class="anchor" aria-label="anchor" href="#rscript"></a>
</h2>
<p>Rscript is an application for running R scripts from the command
line. For an introduction to the command line, see episodes 1–3 of <a href="https://swcarpentry.github.io/shell-novice/index.html" class="external-link">The Unix
Shell</a>. For an introduction to Rscript, see <a href="https://swcarpentry.github.io/r-novice-inflammation/05-cmdline.html" class="external-link">Command-Line
Programs</a>.</p>
<p>The simplest usage is a command like</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">Rscript</span> myfile.R</span></code></pre></div>
<p>This launches a new R session, runs whatever code is in
<code>myfile.R</code>, and ends the session. When the session ends, all
objects in it disappear, unless they were saved to disk.</p>
<p>Rscript accepts additional arguments, which are placed after the path
to the file being run, as in</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">Rscript</span> myfile.R <span class="at">--n_iteration</span><span class="op">=</span>10 output.rds</span></code></pre></div>
<p>In this example, <code>--n_iteration=10</code> is a named argument,
and <code>output.rds</code> is an unnamed argument. Named arguments have
the format</p>
<pre><code>--&lt;name&gt;=&lt;value&gt;</code></pre>
<p>Note that there must not be a space between the name, the
<code>=</code> sign, and the value, so this would be invalid:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">Rscript</span> myfile.R <span class="at">--n_iteration</span> = 10 output.rds   <span class="co"># invalid!</span></span></code></pre></div>
<p>Named arguments can also have a single dash and single letter, as
in</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">Rscript</span> myfile.R <span class="at">-n</span><span class="op">=</span>10</span></code></pre></div>
<p>When Rscript is called with additional arguments, Rscript supplies
the names and values for these arguments to the R session. The names and
values can be accessed from within the session using base R function <a href="https://search.r-project.org/R/refmans/base/html/commandArgs.html" class="external-link">commandArgs()</a>.
Working with <code><a href="https://rdrr.io/r/base/commandArgs.html" class="external-link">commandArgs()</a></code> is, however, tricky.
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> is an alternative to
<code><a href="https://rdrr.io/r/base/commandArgs.html" class="external-link">commandArgs()</a></code>, designed specifically for workflows for data
analysis.</p>
</div>
<div class="section level2">
<h2 id="calling-cmd_assign-inside-a-script">Calling <code>cmd_assign()</code> inside a script<a class="anchor" aria-label="anchor" href="#calling-cmd_assign-inside-a-script"></a>
</h2>
<p>We will work through an example where we call
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> inside a script that is being run from the
command line.</p>
<p>Our current working directory contains two files:</p>
<pre class="fansi fansi-output"><code><span style="color: #0000BB; font-weight: bold;">.</span>
├── airmiles.csv
├── <span style="color: #00BB00;">fig_smoothed.R</span>
└── report.qmd
</code></pre>
<p>The file <code>airmiles.csv</code> holds data on annual passenger
numbers:</p>
<pre><code>year,passengers
1937,412
1938,480
1939,683
1940,1052
1941,1385
1942,1418
1943,1634
1944,2178
1945,3362
1946,5948
1947,6109
1948,5981
1949,6753
1950,8003</code></pre>
<p>The file <code>fig_smoothed.R</code> contains the following code:</p>
<pre><code><span></span>
<span><span class="co">## Specify packages, inputs, and outputs ------------------</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayesiandemography.github.io/command/">command</a></span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cmd_assign.html">cmd_assign</a></span><span class="op">(</span>.airmiles <span class="op">=</span> <span class="st">"data/airmiles.csv"</span>,</span>
<span>           n_knot <span class="op">=</span> <span class="fl">10</span>,</span>
<span>           .out <span class="op">=</span> <span class="st">"fig_smoothed.png"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Read in data -------------------------------------------</span></span>
<span></span>
<span><span class="va">airmiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">.airmiles</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Analyse ------------------------------------------------</span></span>
<span></span>
<span><span class="va">smoothed</span> <span class="op">&lt;-</span> <span class="va">airmiles</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>smoothed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">smooth.spline</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">passengers</span>,</span>
<span>                                         nknots <span class="op">=</span> <span class="va">n_knot</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">smoothed</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">passengers</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Smoothed using"</span>, <span class="va">n_knot</span>, <span class="st">"knots"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Save results -------------------------------------------</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">.out</span>, width <span class="op">=</span> <span class="fl">200</span>, height <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>This code</p>
<ul>
<li>reads in data from a file whose name is specified by
<code>.airmiles</code>,</li>
<li>smooths the passenger data, with the amount of smoothing controlled
by <code>n_knot</code>,</li>
<li>plots the smoothed and unsmoothed values, and</li>
<li>writes the plot out to a file whose name is specified by
<code>.out</code>.</li>
</ul>
<p>We use Rscript to run the code from the command line.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">Rscript</span> fig_smoothed.R airmiles.csv 8 fig_smoothed_8.png</span></code></pre></div>
<pre class="fansi fansi-output"><code><span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`.airmiles`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">"airmiles.csv"</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"character"</span>.
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`n_knot`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">8</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"numeric"</span>.
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`.out`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">"fig_smoothed_8.png"</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"character"</span>.
null device 
          1 
</code></pre>
<p>Rscript started a new R session, ran the code using the command line
arguments we passed in, and ended the session.</p>
<p>The call to <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> in <code>fig_smoothed.R</code>
created objects <code>.airmiles</code>, <code>n_knot</code>, and
<code>.out</code> inside the R session. The values for these objects
were taken from the command line, and <em>not</em> from the original
call to <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code>. Hence, <code>n_knot</code> equaled
<code>8</code> rather than <code>10</code>, and <code>.out</code>
equaled <code>"fig_smoothed_8.png"</code> rather than
<code>"fig_smoothed.png"</code>.</p>
<p>Our working directory now looks like this:</p>
<pre class="fansi fansi-output"><code><span style="color: #0000BB; font-weight: bold;">.</span>
├── airmiles.csv
├── <span style="color: #00BB00;">fig_smoothed.R</span>
├── <span style="color: #BB00BB; font-weight: bold;">fig_smoothed_8.png</span>
└── report.qmd
</code></pre>
<p>We have a new file called <code>"fig_smoothed_8.png"</code>.</p>
</div>
<div class="section level2">
<h2 id="what-cmd_assign-does-when-called-in-a-script">What <code>cmd_assign()</code> does when called in a script<a class="anchor" aria-label="anchor" href="#what-cmd_assign-does-when-called-in-a-script"></a>
</h2>
<p>When <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> is called in a script that is being
run from the command line, it does three things:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Match</strong> command line arguments against arguments in
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code>.</li>
<li>
<strong>Coerce</strong> each value supplied at the command line to
have the same class as the corresponding value in the call to
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code>.</li>
<li>
<strong>Assign</strong> the resulting values to the global
environment.</li>
</ol>
<p>Say, for instance, that we have a script called <code>model.R</code>
containing the following call to <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cmd_assign.html">cmd_assign</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="st">"data/dataset.csv"</span>,</span>
<span>           n_iter <span class="op">=</span> <span class="fl">5</span>,</span>
<span>           use_log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           .out <span class="op">=</span> <span class="st">"out/model.rds"</span><span class="op">)</span></span></code></pre></div>
<p>We run <code>model.R</code> from the command line using</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">Rscript</span> model.R data/dataset2.csv out/model2.rds <span class="at">--use_log</span><span class="op">=</span>TRUE <span class="at">--n_iter</span><span class="op">=</span>10</span></code></pre></div>
<p>When it is first called, <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> holds the
following values:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th>Value from call</th>
<th>Value from command line</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>.data</code></td>
<td><code>"data/dataset.csv"</code></td>
<td>&lt;none&gt;</td>
</tr>
<tr class="even">
<td align="left"><code>n_iter</code></td>
<td><code>5</code></td>
<td>&lt;none&gt;</td>
</tr>
<tr class="odd">
<td align="left"><code>use_log</code></td>
<td><code>TRUE</code></td>
<td>&lt;none&gt;</td>
</tr>
<tr class="even">
<td align="left"><code>.out</code></td>
<td><code>"out/model.rds"</code></td>
<td>&lt;none&gt;</td>
</tr>
</tbody>
</table>
<p>In the <strong>match</strong> step, `cmd_assign() finds the values
that were passed in from the command line. First it matches named
arguments from the command line with named arguments from the call,
yielding</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th>Value from call</th>
<th>Value from command line</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>.data</code></td>
<td><code>"data/dataset.csv"</code></td>
<td>&lt;none&gt;</td>
</tr>
<tr class="even">
<td align="left"><code>n_iter</code></td>
<td><code>5</code></td>
<td><code>10</code></td>
</tr>
<tr class="odd">
<td align="left"><code>use_log</code></td>
<td><code>TRUE</code></td>
<td><code>"TRUE"</code></td>
</tr>
<tr class="even">
<td align="left"><code>.out</code></td>
<td><code>"out/model.rds"</code></td>
<td>&lt;none&gt;</td>
</tr>
</tbody>
</table>
<p>Then it matches unnamed arguments from the command line with unused
arguments from the call. The matching of unnamed arguments is based on
the order in which the unnamed arguments were supplied to the command
line. In our example, the value <code>"data/dataset2.csv"</code> was
passed before <code>"out/model2.rds"</code>, so
<code>"data/dataset2.csv"</code> comes before
<code>"out/model2.rds"</code> in the matched results.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th>Value from call</th>
<th>Value from command line</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>.data</code></td>
<td><code>"data/dataset.csv"</code></td>
<td><code>"data/dataset2.csv"</code></td>
</tr>
<tr class="even">
<td align="left"><code>n_iter</code></td>
<td><code>5</code></td>
<td><code>"10"</code></td>
</tr>
<tr class="odd">
<td align="left"><code>use_log</code></td>
<td><code>TRUE</code></td>
<td><code>"TRUE"</code></td>
</tr>
<tr class="even">
<td align="left"><code>.out</code></td>
<td><code>"out/model.rds"</code></td>
<td><code>"out/model2.rds"</code></td>
</tr>
</tbody>
</table>
<p>The values supplied at the command line all start out as text
strings. In the <strong>coerce</strong> step, <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code>
converts these values to have the same classs as the matched values from
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code>. In our example, this means coercing
<code>"10"</code> to <code>numeric</code> and coercing
<code>"TRUE"</code> to <code>logical</code>.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Argument</th>
<th>Value from call</th>
<th>Value from command line</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>.data</code></td>
<td><code>"data/dataset.csv"</code></td>
<td><code>"data/dataset2.csv"</code></td>
</tr>
<tr class="even">
<td align="left"><code>n_iter</code></td>
<td><code>5</code></td>
<td><code>10</code></td>
</tr>
<tr class="odd">
<td align="left"><code>use_long</code></td>
<td><code>TRUE</code></td>
<td><code>TRUE</code></td>
</tr>
<tr class="even">
<td align="left"><code>.out</code></td>
<td><code>"out/model.rds"</code></td>
<td><code>"out/model2.rds"</code></td>
</tr>
</tbody>
</table>
<p>Finally, in the <strong>assign</strong> step,
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> puts the values into the global
environment.</p>
<p>The number of arguments passed through the command line must exactly
match the number of arguments specified in the call to
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code>. Values specified in the call to
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> do <em>not</em> act as defaults. For instance,
in our example, <code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> would not let us omit
<code>use_log</code>, and the following would be invalid:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">Rscript</span> model.R data/dataset2.csv out/model2.rds <span class="at">--n_iter</span><span class="op">=</span>10  <span class="co"># invalid!</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="naming-conventions">Naming conventions<a class="anchor" aria-label="anchor" href="#naming-conventions"></a>
</h2>
<div class="section level3">
<h3 id="argument-names-starting-with-a-dot">Argument names starting with a dot<a class="anchor" aria-label="anchor" href="#argument-names-starting-with-a-dot"></a>
</h3>
<p>In all the examples so far, the objects holding paths or filenames
have conformed to a particular naming convention convention: these
objects have all had names that start with a dot. For instance:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cmd_assign.html">cmd_assign</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="st">"data/dataset.csv"</span>, <span class="co"># '.data' starts with a dot</span></span>
<span>           n_iter <span class="op">=</span> <span class="fl">5</span>,</span>
<span>           use_log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           .out <span class="op">=</span> <span class="st">"out/model.rds"</span><span class="op">)</span>     <span class="co"># '.out' starts with a dot</span></span></code></pre></div>
<p>This idea behind the convention is to distinguish between values and
references. <code>n_iter</code> and <code>use_log</code> in the example
above hold values that are directly used in the analysis.
<code>.data</code> and <code>.out</code>, in contrast, describe were
values are stored. The distinction is analogous to the one between
ordinary variables and <a href="https://w.wiki/DvZK" class="external-link">pointers</a> in
C.</p>
<p>To access the values referred to by the “dot” variables, we use a
function such as <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code> or <code>read_csv()</code>, as
in</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="va">.data</span><span class="op">)</span></span></code></pre></div>
<p>The dot-name convention is not compulsory, and
<code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> does not check for it. But the convention is
nevertheless worth following, as it can be easy in practice to get
confused between a value and a reference to the value.</p>
</div>
<div class="section level3">
<h3 id="giving-code-files-and-outputs-the-same-base-name">Giving code files and outputs the same base name<a class="anchor" aria-label="anchor" href="#giving-code-files-and-outputs-the-same-base-name"></a>
</h3>
<p>Another feature of the examples so far is that files with R code have
had the same base name as the files they generated as output. File
<code>fig_smoothed.R</code>, for instance, generated
<code>fig_smooth.png</code>, <code>fig_smooth_5.png</code>,
<code>fig_smooth_8.png</code>, and <code>fig_smooth_10.png</code>, and
file <code>model.R</code> generated <code>model.rds</code> and
<code>model2.rds</code>. We rely on file extensions (eg <code>.R</code>
vs <code>.png</code>) to distinguish code from outputs, and we use
suffixes (eg <code>_5</code>, <code>_8</code> and <code>_10</code>) to
distinguish different versions of the same output.</p>
<p>Naming conventions like this are common in system programming, and
are a good way to signal the relationship between code and outputs.</p>
</div>
</div>
<div class="section level2">
<h2 id="putting-calls-to-rscript-in-a-shell-script">Putting calls to Rscript in a shell script<a class="anchor" aria-label="anchor" href="#putting-calls-to-rscript-in-a-shell-script"></a>
</h2>
<p>We can create a data analysis workflow by writing a shell script with
calls to Rscript.</p>
<p>We illustrate with a simple example. We need two new files. The first
file, called <code>report.qmd</code>, creates a report with two figures.
It contains the following code.</p>
<pre><code>---
title: "Smoothed Passenger Miles"
format: html
---

We use a spline to smooth data on passenger miles.

```{r}
#| label: fig_smoothed_side_by_side
#| echo: false
#| layout-ncol: 2
knitr::include_graphics(c("fig_smoothed_5.png", "fig_smoothed_10.png"))
```</code></pre>
<p>The second file, called <code>workflow.sh</code>, is a shell script
that runs the whole workflow. It contains the following code:</p>
<pre><code>
Rscript fig_smoothed.R airmiles.csv 5 fig_smoothed_5.png 

Rscript fig_smoothed.R airmiles.csv 10 fig_smoothed_10.png 

Rscript -e "quarto::quarto_render('report.qmd')"</code></pre>
<p>The third command in <code>workflow.sh</code> contains an
<code>"-e"</code> after the <code>"Rscript"</code>. The
<code>"-e"</code> option tells Rscript to use code from one or more
quoted R expressions (which follow immediately after the
<code>"-e"</code>), rather than a file.</p>
<p>We run <code>workflow.sh</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">bash</span> workflow.sh</span></code></pre></div>
<pre class="fansi fansi-output"><code><span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`.airmiles`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">"airmiles.csv"</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"character"</span>.
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`n_knot`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">5</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"numeric"</span>.
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`.out`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">"fig_smoothed_5.png"</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"character"</span>.
null device 
          1 
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`.airmiles`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">"airmiles.csv"</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"character"</span>.
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`n_knot`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">10</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"numeric"</span>.
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`.out`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">"fig_smoothed_10.png"</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"character"</span>.
null device 
          1 
<span style="color: #BB0000;">

processing file: report.qmd
1/3                            
2/3 [fig_smoothed_side_by_side]
3/3                            
output file: report.knit.md

</span><span style="color: #BB0000; font-weight: bold;">pandoc </span><span style="color: #BB0000;">
  to: html
  output-file: report.html
  standalone: true
  section-divs: true
  html-math-method: mathjax
  wrap: none
  default-image-extension: png
  variables: {}
  
</span><span style="color: #BB0000; font-weight: bold;">metadata</span><span style="color: #BB0000;">
  document-css: false
  link-citations: true
  date-format: long
  lang: en
  title: Smoothed Passenger Miles
  
Output created: report.html

</span>
</code></pre>
<p>Our working directory now contains the two graphs and the report
(plus a directory, called <code>report_files</code>, created by
quarto.)</p>
<pre class="fansi fansi-output"><code><span style="color: #0000BB; font-weight: bold;">.</span>
├── airmiles.csv
├── <span style="color: #00BB00;">fig_smoothed.R</span>
├── <span style="color: #BB00BB; font-weight: bold;">fig_smoothed_10.png</span>
├── <span style="color: #BB00BB; font-weight: bold;">fig_smoothed_5.png</span>
├── <span style="color: #BB00BB; font-weight: bold;">fig_smoothed_8.png</span>
├── report.html
├── report.qmd
├── <span style="color: #0000BB; font-weight: bold;">report_files</span>
└── <span style="color: #00BB00; font-weight: bold;">workflow.sh</span>
</code></pre>
<p>The report itself looks like this:</p>


<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>
Smoothed Passenger Miles
</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>
<script src="report_files/libs/clipboard/clipboard.min.js"></script><script src="report_files/libs/quarto-html/quarto.js" type="module"></script><script src="report_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script><script src="report_files/libs/quarto-html/popper.min.js"></script><script src="report_files/libs/quarto-html/tippy.umd.min.js"></script><script src="report_files/libs/quarto-html/anchor.min.js"></script><link href="report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report_files/libs/bootstrap/bootstrap.min.js"></script><p><link href="report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet"><link href="report_files/libs/bootstrap/bootstrap-afd9ac220a24f39b8678a13d115d9db3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"></p>


<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h2 class="title">
Smoothed Passenger Miles
</h2>
</div>
<div class="quarto-title-meta">

</div>
</header><p>
We use a spline to smooth data on passenger miles.
</p>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>
<img src="fig_smoothed_5.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>
<img src="fig_smoothed_10.png" class="img-fluid"></p>
</div>
</div>
</div>
</main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div>
<p><!-- /content --></p>


</div>
<div class="section level2">
<h2 id="putting-calls-to-rscript-in-a-makefile">Putting calls to Rscript in a Makefile<a class="anchor" aria-label="anchor" href="#putting-calls-to-rscript-in-a-makefile"></a>
</h2>
<p>An even better way to organize a data analysis workflow is to put the
Rscript commands in a Makefile. For an introduction to Makefiles, see <a href="https://jeroenjanssens.com/dsatcl/chapter-6-project-management-with-make" class="external-link">Project
Management with Make</a>.</p>
<p>Here the Makefile equivalent of the <code>workflow.sh</code>
file:</p>
<pre><code>
.PHONY: all
all: report.pdf

fig_smoothed_5.png: fig_smoothed.R airmiles.csv
    Rscript $^ $@ --n_knot=5  

fig_smoothed_10.png: fig_smoothed.R airmiles.csv
    Rscript $^ $@ --n_knot=10

report.pdf: report.qmd fig_smoothed_5.png fig_smoothed_10.png
    Rscript -e "quarto::quarto_render('$&lt;')"</code></pre>
<p>We delete <code>fig_smoothed_5.png</code> and run the Makefile.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">rm</span> fig_smoothed_5.png</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="fu">make</span></span></code></pre></div>
<pre class="fansi fansi-output"><code>Rscript fig_smoothed.R airmiles.csv fig_smoothed_5.png --n_knot=5  
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`.airmiles`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">"airmiles.csv"</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"character"</span>.
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`n_knot`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">5</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"numeric"</span>.
<span style="color: #00BB00;">✔</span> <span style="color: #555555;">Assigned object</span> <span style="color: #0000BB;">`.out`</span> <span style="color: #555555;">with value</span> <span style="color: #0000BB;">"fig_smoothed_5.png"</span> <span style="color: #555555;">and class</span> <span style="color: #0000BB;">"character"</span>.
null device 
          1 
Rscript -e "quarto::quarto_render('report.qmd')"
<span style="color: #BB0000;">

processing file: report.qmd
1/3                            
2/3 [fig_smoothed_side_by_side]
3/3                            
output file: report.knit.md

</span><span style="color: #BB0000; font-weight: bold;">pandoc </span><span style="color: #BB0000;">
  to: html
  output-file: report.html
  standalone: true
  section-divs: true
  html-math-method: mathjax
  wrap: none
  default-image-extension: png
  variables: {}
  
</span><span style="color: #BB0000; font-weight: bold;">metadata</span><span style="color: #BB0000;">
  document-css: false
  link-citations: true
  date-format: long
  lang: en
  title: Smoothed Passenger Miles
  
Output created: report.html

</span>
</code></pre>
<p>Whereas the bash script <code>workflow.sh</code> would have recreated
<code>fig_smoothed_5.png</code>, <code>fig_smoothed_10.png</code> and
<code>report.html</code>, Make recognises that
<code>fig_smoothed_10.png</code> is still up-to-date, so it only
recreates <code>fig_smoothed_5.png</code> and
<code>report.html</code>.</p>
<p>Makefiles take some time to master, but they have important
advantages, discussed in <a href="https://bayesiandemography.github.io/command/articles/workflow.html">A
Workflow for Data Analysis</a>.</p>
</div>
<div class="section level2">
<h2 id="sec:alt">Alternatives to <code>cmd_assign()</code><a class="anchor" aria-label="anchor" href="#sec:alt"></a>
</h2>
<p><code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> is not the only option for processing
command line arguments.</p>
<p>One alternative is <a href="https://search.r-project.org/CRAN/refmans/R.utils/html/cmdArgs.html" class="external-link">cmdArgs()</a>
in package <a href="https://cran.r-project.org/web/packages/R.utils/index.html" class="external-link">R.utils</a>,
which is a more user-friendly version of the base R function
<code><a href="https://rdrr.io/r/base/commandArgs.html" class="external-link">commandArgs()</a></code>.</p>
<p>Another is package <a href="https://cran.r-project.org/web/packages/docopt/index.html" class="external-link">docopt</a>,
which can be used to construct an interface for script, including the
processing of command line arguments.</p>
<p><code><a href="../reference/cmd_assign.html">cmd_assign()</a></code> is more specialised than
<code>cmdArgs()</code> or <strong>docopt</strong>. It focuses
specifically on the task of processing command line arguments as part of
a data analysis workflow.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Bryant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
